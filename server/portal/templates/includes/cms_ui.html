<style id="cms-ui-styles" media="not all">{# i.e. disabled #}
  @layer mimic-cms, mimic-cms.base, mimic-cms.project;

  @import url(/static/site_cms/css/build/core-styles.base.css) layer(mimic-cms.base);
  @import url(/static/site_cms/css/build/core-styles.cms.css) layer(mimic-cms.base);
  @import url(/static/site_cms/css/build/core-cms.css) layer(mimic-cms.project);

  /* To mimic a CMS idiosyncrasy */
  /* https://github.com/TACC/Core-CMS/blob/v4.31.0/taccsite_cms/templates/base.html#L73-L76 */
  #cms-content-container.container .container { padding-inline: 0; }

  /* To mimic Bootstrap v4 (which CMS uses) */
  .workbench-content .container { --bs-gutter-x: 15px; }
  .workbench-content .row { --bs-gutter-x: 30px; }

  /* To change high-level styles to match CMS */
  .workbench-wrapper { color: var(--global-color-primary--x-dark); }
  .workbench-content .container {
    margin-left: revert-layer;
    max-width: revert-layer;
  }
  .workbench-content .row {
    margin-right: revert-layer;
    margin-left: revert-layer;
  }
  body { -webkit-font-smoothing: revert; }
  .c-button { --max-width: auto; }

  /* To change Portal's Bootstrap styles to match CMS */
  .workbench-wrapper .dropdown-menu,
  .workbench-wrapper .dropdown-menu::before,
  .workbench-wrapper .dropdown-menu::after,
  .workbench-wrapper .dropdown-item,
  .workbench-wrapper .dropdown-item:focus,
  .workbench-wrapper .dropdown-item:hover,
  .workbench-wrapper .dropdown-divider {
    all: revert-layer;
  }

  /* To hide navbar */
  /* TODO: Instead of this, component using CMS styles should not use navbar */
  #react-root:has(#mimic-cms) .nav-sidebar {
    display: none;
  }
</style>

<script id="cms-ui-script" type="module">
  let footerEl = null;
  let footerOriginalMarkup = null;

  const toggleStyles = (enabled) => {
    const media = (enabled) ? 'all' : 'not all';
    document.getElementById('cms-ui-styles').media = media;
  };

  const toggleLayout = (enabled) => {
    document.body.classList.toggle('has-cms-ui', enabled);
  };

  const useCMSFooter = async () => {
    footerEl = document.getElementById('footer');
    footerOriginalMarkup = footerEl.outerHTML;

    const { replaceFromURL } = await import('/static/site_cms/js/modules/importHTML.js');
    footerEl = await replaceFromURL('/cms/markup/footer', footerEl);
  };
  const restorePortalFooter = () => {
    footerEl.outerHTML = footerOriginalMarkup;
  };

  window.addEventListener('cms-styles-activated', async (event) => {
    console.log(`event: ${event.type}`);
    toggleStyles(true);
    toggleLayout(true);
    await useCMSFooter();
  });
  window.addEventListener('cms-styles-deactivated', (event) => {
    console.log(`event: ${event.type}`);
    toggleStyles(false);
    toggleLayout(false);
    restorePortalFooter();
  });
</script>
